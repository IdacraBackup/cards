import postgres from 'https://deno.land/x/postgresjs/mod.js';

const json = `
["1184221955769229312","2995822990","1459154846527803394","1352357458610589696","263150631","1579909045498036225","2507148584","25121136","9709362","1425454808350199820","772774741203615745","4845031500","2463725143","1409523572188401676","1530107785014296576","1127153939089055744","1577545846928728064","1535214456434745345","1499679434634313732","1456271146832183296","1575981858214580234","1483021534943977477","1423385706790105097","1059851910071619585","1014944841581715456","1275586328894242817","415186112","1203333681248702465","4527965189","994668511564783619","1572757883317587969","1390707507711066112","1001114465692200960","1567199487008841731","19878985","27416387","1233016206636068867","3309855064","1105477354363727873","109404961","1071901771","19258192","1378369918479912961","1402697726534447106","1319269656264409088","743958196138606593","855063326","1562825612602982403","1127248134558572544","1550534510336512000","15093930","1529947111038631952","1491428387407212549","1041482401937911809","407800233","17032413","19526523","27022859","109204321","1248009420203683840","1532646543886536706","299990613","2934919360","14659273","1407831179995148288","2447454659","2890568105","1449486180391784454","1321123451017506818","2796372340","840677333556219905","1432739296008671245","3621441793","1360601391706894336","1396212013","1525080756464279552","719545318023524352","48667415","1462285412425109505","1333507807228932098","1307056292465274880","1216901847673229313","1393953089892364297","11235612","1326460828279840768","1013869004803325952","23583938","1469750361267359744","347777511","4767304221","16611249","1466125035723280386","819229761767542784","281185181","1024895094875406336","91908253","3882541216","18559099","831266147643359233","3258109273","15480566","905409585359360001","1226451435006517248","1458163890718654471","177384756","1191477472396763136","45626199","1319094897597534210","1474467183740735491","1200552729648750592","1329580870894837764","1332812378098995200","1016086594544193537","3238924744","13129332","1330335212509786113","872174229315366912","4589946195","8205292","875512466","790596805943787520","1358063557758320646","14137255","1490092018118316032","886591008338616320","1438595498936389633","3288969152","10148252","1418591799103442950","67307059","1115059776952655872","1461245324430028802","12497","50664510","1343963208567156739","2470584223","39394680","3083949253","66961750","1385012718629912583","12665","1392571943254102017","1345451551243063301","1416986780662865922","1122523614","1343443016","701056763005632512","6155982","15948437","1392507001587052549","1346217747160694791","54470325","211230935","15453","2340086665","716328412042756096","1397820875156733952","937212200782929921","1516926679","16705419","3293567601","268659869","1213630315643621377","1063490800766672909","1399866136787918850","1331009587303084035","1459556043785216009","1470434006491611137","328863384","835153103762550785","759185474","1397875200063066112","374678161","12","1469427907","1094762324097822720","39141147","1019278000200781825","1301452754683072512","1138044863952429059","1270459833800523776","826589963747749891","1460761704565030912","1384699902295425026","1270723495765270535","1457075140475359239","109679697","2977434234","1267747622242189313","1467726470533754880","191996444","888682616827805701","223057419","3202468955","1178020651069607938","1360298161189707777","1392386366839959552","180165860","1348259034596581376","1138373711860551681","14250139","14103325","779566","1006815028350201856","370418635","1435689603219001352","376615959","12745092","3224478028","1935829315","89750468","326729614","30380568","1084497636491751424","9980812","1263566261172047872","1233461041427832832","14290535","4023142698","856929295","3076267558","1577241403","867345444359229440","334173439","15912257","1289241168983859204","14114731","3038957769","297136187","1255500442898964481","1394379173133705216","174047038","214990133","1384763082820530176","3402579663","1177765978098110469","135196829","1385230127357841411","6619162","774980380562776064","16633935","1168926412960673792","94579306","2983898013","3167734591","164613241","141737249","1429739584028565505","917163626238140421","964202120361709569","25406960","11725712","1291866751177617408","916695970330619904","373414474","34563390","565038870","248350439","1360542136584859649","2616801128","1443480602624278528","14471876","1435245955058601986","1175846517808226305","363748233","1420673322233126915","989637306549059586","11342852","32499999","759643578050211840","1435683576301985796","613597516","1493071","759948693214785536","1204202807298969600","1312068115769982976","1237067436794490880","786375418685165568","1602424753","327034465","1182706051788861440","1009141967245234176","3075701561","1339487819903856640","116059118","1412183304544030721","2547376081","1150565092678701058","1149659794254512128","1175119837653159936","914738730740715521","13567","813192596445102080","517723461","946282488745246720","1052950055391518722","1422579886263316489","18776422","751872982751076352","2408010187","2748436880","1032122577945157632","676573","1214951331942850562","1328610006116175872","60335483","1200603773971968001","1364623195702128642","2169383071","912255209988136960","2449991611","1107013728980123649","1238362520404070400","1132593740730818560","259819054","1179188958","922764696217939968","1377285381012520965","2489440172","19060292","244965762","1308732128","2159323767","1260557395731898379","15004003","513541325","129940111","98734097","83389771","2563028120","82035190","3405265264","80847569","268414753","258020873","1222451844506705920","349764173","30678696","161438267","1200570042644979712","15833737","1219566488325017602","197539492","1360839410","1233148478311845888","47311473","1118652581310545922","97267781","1008813357674221569","1231065733918068736","631584651","1484994439","1204002279759630338","762064146254790656","4318505893","443693878","744184178959331328","18406943","3578710817","2279695508","1265036375226793985","9869852","2872225385","960226588901060608","14973154","836807059307970561","937000244650192897","2006261","1330733819788365824","1224730221557043202","1197814696176443394","995950861158371328","775587809990180864","2151249600","559874604","471425374","43294111","3269048996","842825256","16252784","1253463451923406848","29961025","837770064870817792","18040523","808773491340128256","1127940698408353793","1050166310","827522510115708932","1147714147","3024435542","857755658","103049472","44158655","634910826","2929523963","1144396340585218048","878674517303771136","96383","14436816","375647729","91569435","18437787","41262231","3240989276","3352334774","317052870","1274458723948195840","1351423329404502016","109274686","815246","1069665489968947206","1097943475553746945","9840502","931954454647201792","1367619103142211586","1376650370340986883","1101157389670203393","353516065","24860357","1071037771","56822549","82390751","104170595","1355987866225057792","1273277512324460547","2247686810","898817431346462720","17013577","6202072","949639269433380864","7895442","891651670341505024","10238842","15077220","1351303110061400072","19028022","1144341124888375302","211868191","312750384","14228668","353123498","12459132","1227996920578289665","24461314","952672538752114688","2663354646","1006610672220889088","18123","33905417","52045074","565389358","104125863","1361081587576631303","16138164","75840965","555311904","67597330","38855188","2387344327","3041691168","1268583741586313217","14566494","1332413270012030978","1907615988","1296137392873705472","1179771784691888131","937270474303819777","3170530665","1248882094404591616","3514625473","722390861716201472","1070334311998636032","1680507342","53877705","126413923","11752","18859537","956475467246129152","3233891310","4746195084","1024328673397272576","4389158909","1419909222","800742744838709248","204092553","1148728567829712896","1263579586589126658","163509321","17814884","2612511750","6642222","1193429358972567553","17336996","1200926075733176320","1667831797","14335789","769075608966103044","1019065878","1655361650","294341225","1244394605904187393","1061354255855038466","420100653","716700508900225024","18636799","3405478876","1694135276","17573316","7432832","1331987451955601419","2174967073","14321903","1120686272912273410","38389571","958043149275934720","2966958004","171393795","734903","24234699","19118246","999630016236412934","1234053308","1151716443815403522","17459118","1162880321106456581","14202976","3161763159","59907324","881760808048353280","403300382","823799206267625473","3030006159","2190757022","778395996619431937","773578637320880128","676363","7886062","1302876380561055744","4226891363","190611671","1260851321542004737","1251165071511678984","1287832661759754240","1016259372933111809","112212512","1080145546302705665","860002628566040576","911417066","189045861","1281777687850127360","2384259584","1294979453005770753","1073291808124358657","18200355","1248988439346917383","253693350","1031532478882897920","15353121","41865992","15970402","1310652921789452288","532375536","2377753129","229027174","16664291","921038155809161216","15076743","910634408134275074","587876943","1025295395579080704","1099843636886466560","888220718","1678726447","167374011","20696007","523579742","4724816729","278078915","1130859649782169600","285875744","130790945","16313292","3769639222","9992452","809785337400754176","2785629930","1204057117654736897","346640777","396796235","366913586","1318178412666802176","165005708","1202558760926867456","1158104534587195393","1306001661534507008","1007762316404973570","1040931421022560256","1529661","14310843","793891318711713792","1152973393454436352","1277787824436043777","38622007","512393070","108557659","810533393658249216","893767287240626177","834157596","97086285","15979784","520838347","96794983","1052740517186818049","416394303","1309852068887355392","1125658534543106048","200094129","176553285","2865849363","755723077141528576","932660101378387968","958620614486618112","1123296468608139264","1615109696","1158752291354230784","221658618","18577218","57470095","3377256880","1051546831279280128","754073418446671873","843352079397781506","21046936","383470568","1298617905647628288","14253911","235240066","20308111","111391654","15926775","1168003019620773888","456846125","32865583","780281883875651584","1300810141432819720","909844465","1008661573567696896","178926812","1039451984779206656","1291120752863846400","2313873457","1250847387062419456","1115198261038546945","3741075807","2187391993","1199812749469126657","2789135402","1239876481951596545","50274262","113707401","111011433","2888994008","28544844","92796966","33610008","1192893578214641664","726046634749079552","1225485951192924160","1260331112284295169","1129324731780538368","50136899","176918487","384841727","4409501","140927249","1060927199287619585","386081360","2874953001","4509280880","19721574","1048907401993146368","2924546800","2882960978","968253066255392768","744099674","1083729788701880320","2430112322","413898659","1186216596005675010","381095625","2412913339","720084689579417600","1170576325343633408","1244002803833544705","1217200812","3334388927","471768380","1726747806","10821","131838592","1156682289411047424","18173885","1095308466531590146","1215118584608804864","832065353509330944","17781158","761613","1067926271856766976","554765148","985651867798482944","722579682298880000","719836512","2379659060","33542859","806184523268583428","20527686","5576742","1010017530","2279172710","1250697521527209984","2225752344","875219423073681409","817441137099214849","1099627232480428032","1562742319","1150808818231795720","35453305","816948136841252864","14151945","1216341544812318721","174191236","62683216","2518685112","1216879775026839552","12514","779361473063555072","854353812743753728","1216870960092942337","1247781984639651840","16616694","2778013788","2292831438","1247457755457339394","768841415375880192","1201238093002661888","1125050756032335872","1045647478308130816","1013640222771253248","22866748","110276487","257554379","21714822","711600634819170304","801431281678618624","2291660286","425557536","1034856210464301056","17661950","836308794774814721","82749731","193001775","1373204288","1012723378480918530","4733481983","1034342415900069888","951816093856911362","803929332435603457","25269093","4705259412","36865698","3362527468","1004293112146079745","738063809089286145","3031502607","1194884064202768384","2559463297","223807771","3342117765","941272606786949125","1052640935979470848","1205141396744744960","14425976","604296890","70438825","2880772120","1241766567194562562","835954692450627587","122246321","2813249270","3280342163","919636441709400064","4686835494","54400793","1013771234637737985","2347049742","74401965","119318112","4904574574","430207771","785894995488182272","17055506","79053","15050812","1044484186143256576","1095103068373508101","2774638535","57418430","811098595","14114392","12447112","21046030","143935540","1139436660683411456","3420749333","621169905","4716205469","1248773725731897344","1189882102818516992","50339173","242493681","1245333424589746176","197134898","4159389322","526738591","972586638","263309165","6062412","995236401259208704","2935275869","637029844","951578880023908352","326854001","518224370","1035497025306075137","984885432101015557","4910809053","959462629407379456","268227446","311880926","1225094897780297729","66321639","205177680","2559180949","559982472","296160363","715451644683673601","75162930","3630411","1101843102401220608","23828738","1133424575545528322","3258906265","81047449","1111897658640207872","1291224355","2444171906","17011212","831200054","13645402","705726541","778186209013235713","92462226","25974085","3916461","22151118","455765615","131941348","1368077496","15996668","95171787","33521530","112849341","471282013","228794947","855835988","492561264","36156834","4251433696","35833820","621157736","25995622","1241921663828021248","3190865591","19285503","61542667","4834580908","16878537","17339650","1150908139","2402097420","15864337","1230546225491062784","1169611209093648384","1181732088757854208","1055455016054595591","1202259425966338048","1218996709432406017","1045321775930900481","2851763643","720544068","53175441","1223667759524933633","187574329","1368007404","395580696","2922722177","1141628951229542401","2360511","59553444","964888487601344513","372543939","1196556983203176449","1883861610","24035747","215129127","1189966273","217553965","329059137","18597766","1128416609905909760","1241088222492491776","206171400","14170066","739530479477624832","1077527957533528070","1231437004941905921","1183463152328962049","34046334","1158755645354643462","1007612847113764864","17411711","343928585","1218603061418967040","1169787245391310849","1150929123470000128","81712767","2759881456","356372698","1070997050559471617","980401255255191552","12473952","339639180","172921389","1657873424","212632603","14157781","1247640911686729728","1144947298373459970","1211936861582581761","988374996","17271117","100711336","17562763","1144122681278816256","5502392","2698121299","1068853583976824832","868872523622035457","906102344412270592","398382142","546982126","39074490","4924429943","1139581793961684993","1087721917786804224","190219751","626667524","2232339498","4745674136","1108769816230293504","2369823440","22907526","964949102084677633","176864575","85008547","2826554209","1209058678042775552","86731307","2583098944","15060066","1146129989311578113","1168568340492750849","11980612","2247691345","1175464650395111424","1145561764840390656","1203383252","15131982","321610466","1426516525","158093167","922943158434107392","18929378","1074093550466424833","670483","2876345515","960695930","983917611149938688","2938471462","2493744372","22291414","22","1036391932665065473","478448085","1183131067043192832","890629108518068225","56391956","1491081","840626569743912960","3280621238","1097513783512182789","994857111350890504","857538299874902016","1005520628533719040","2433088512","599091041","19037299","3385160777","98400821","1003622629","856306050","1121405370281472000","266122356","24023995","2890926991","14193597","881440736","9588752","37749439","1190410678273626113","1224772223581523968","3119747872","42612896","390167291","383012058","4772521229","67640827","1089278012","3378683693","784329896","170265794","34706535","11134312","1520228526","813333008","21567037","440825923","1350055422","109690809","731197729448284160","809443269688094720","2408321504","2360241314","1862972077","2739826012","2516688952","1084902554708992000","1088499007377281025","1428328526","89302621","1478433775","977502021686247424","4710215355","2886009040","974698309074944000","2679533714","2301723278","102468337","725616072347521024","981031334201131008","296298053","879302288837357568","755625782","2251689488","928915349201932288","18136606","196905700","23180404","497765144","6149572","2904438646","167176565","239822603","17051356","797236549012197376","16347964","2229122458","862942478495830016","2541676340","1052576094","261582708","1164110868453515264","785536890","3193438206","1178049575141154822","18957805","812422632503214080","1174463960122134528","1075428307997548545","912676345817288705","60051737","1322427607","965800091486511106","2203803738","1075486654499078144","365890346","1191067310863376385","989758265562025986","18230705","1052157242424864768","24232229","1045696890845712386","4505521640","1191585631","826699259441328128","450588678","128196137","3196195263","830568949267980289","873959747199827969","356106530","847740376626503681","316970336","2930407037","11844","1596718267","276438111","15532680","47373249","977164339533832192","1044496567229730818","2833837079","806968755855224832","938143478739034112","1054235330516320257","972049536024752128","4793462534","2191222296","887470481443479556","437901874","684143","2382263972","19619556","3361609025","1123185845257695232","2209194279","42156814","1075154575953252352","205968377","14103828","15156181","2729061","2254182852","86106988","15223775","14131464","27884866","14192340","1067793430863069184","21185883","841246135368986624","830155237474328578","343555785","19240138","136933779","12107362","139487079","95378589","232760709","2871156772","1103941514315481088","568914153","1113553863959818240","125027291","217505532","33519541","1072413109497856000","1140953839551569921","143624402","21888259","460451827","109887413","24179991","13601052","304289713","15687937","14273447","15842591","28395828","2846588599","992415066791317505","2330924354","1074763753802121220","4350302788","17285085","1445619036","584550917","47348084","797566787810230272","1197188248193384449","1198896974394724352","122414972","450025308","892525312566849538","1060961878497726464","4887201538","1196054702783229954","920781143418527744","44100037","14946149","148289820","1115216713958686721","756326958946922496","24574911","15732699","401186577","841142652389199877","188255629","17606964","17615701","154979253","330926073","4241651","3096933139","39017272","434991054","5351112","73253803","254474094","450816884","491539195","152230944","763773908516343808","840839614378188800","48582631","2590374854","198793678","1156940255188148224","2372173357","1897020504","20611180","748470445","2313623570","1144327136670605316","814899606","7618412","6837002","15103611","3188174219","14364083","4441591336","90151483","22918124","1452616772","1121512582706188288","2909455908","1074018771248013313","452783","23081953","3148611379","25711093","988493822614175745","16116378","15193531","15731401","64262436","2704749972","720133605301870592","86938585","44143345","240488821","234640088","881672363779149824","22362043","192024025","716933677","133550476","529701883","912924848288124928","97456304","1334432233","1140542804","34344158","1562750084","8535712","65652445","872159205578477568","2433657151","37933503","28679508","1067198676525871104","15228286","45988084","805891429","1028128482193235968","3068852709","14435843","3272270443","902178677735260160","1102187856502640640","15414060","1153224895389736961","3320945841","15965108","22080446","37125581","14307465","1118033420","2272235102","15437616","81058375","310736264","1098849494","4780060819","2226654343","15790639","43655089","1391876622","104616091","15810479","333430027","378827773","921798776603447296","41549537","1471954039","16098129","916056524442570752","1170731304545071110","2415160136","6603532","437049774","2972186339","3415466992","1009404055666425856","1055164504256974848","754022410689675269","1167405432341782528","989589113325092864","2438767100","34270684","1075374777626435584","1095839383230414848","14620776","266000898","968804306794184704","198426213","46658015","2791021877","22940582","37700778","1106323840286650368","835209520200699909","864995929325060097","186194887","20709019","7029732","142507295","768666718575009792","875500444537237506","120768175","1104051406993002506","234628182","734521897728233472","33750661","36457353","1001465119656865792","819563113087467521","329848887","731106381927993344","2922399689","14447132","875882643614814208","14861745","1056838028","959413785621606400","225752166","15426140","3312093173","2207437280","5011881","184844481","727007448","753631538324000768","88764677","1635786691","202282551","211100214","2414656477","7396342","728012379322077184","14989904","1922982428","118180928","907281","14622451","1458271","4158529099","370453007","522449564","423843269","131965508","263165090","900082145124798464","563963749","105945478","39216185","326332967","395720897","912949947397439488","79181765","127846207","16781974","150582901","181276315","22936543","151535146","51459324","57613118","13581262","312822360","1495156968","94644191","15589215","201186050","464979933","3055936108","4361209829","86221409","861863197057351680","824960338160398337","280790280","2192272340","730035870011691008","158173395","4082747237","4892846735","528339547","16627489","2542755362","360274076","2362979737","1966437091","2832623057","17003263","3012157329","993916929520951296","981325507080814592","12844902","50550121","224395798","121407443","214629170","847970634","18271443","923975767658287104","699463","71115710","511074434","799071635231817729","828293466128056320","736836257414807552","998993803406139393","14602815","1361017273","248823377","15668072","2361333937","99525625","242037033","27803926","3691363526","64014392","791224","17777189","343306629","161569820","2902063171","931508449","823305407284281345","199641637","289243021","609270928","4114805788","16179055","3293424904","20656444","1098433052","17189394","15466461","629432713","1436340385","56992811","19103715","38493588","88905384","835132268","15540222","755178","3373826458","1973498004","495429940","4874452334","4705115736","178849006","323905773","879696238953865217","873855288901865472","758333491616428033","1323129956","296617343","75332107","2843861344","1574000426","20611254","14277202","139757986","16219635","836202140","13804552","3601726756","771583225466531840","4102641","2280472200","14617448","36569081","844540864185749504","184306249","17796425","50055757","814343470114631681","591883","28917111","902178255796453377","852454303763767296","42688050","19662034","15192504","3084906159","59008385","169387148","3134924132","5103","108709377","18692775","14877015","220907584","7456262","489871135","104644424","51518017","2415992448","960435967235690496","142415193","97495292","293479676","243227030","14270895","240315182","3011699732","40658904","3825110656","564069037","722832047224537088","17140452","803395716508848128","3065799191","130462642","822468829364228099","9140752","492678204","41374344","748194882787880960","27546319","183931514","36425256","52704701","24017962","897643597713068032","15381265","458789181","1029051636","72413846","14435226","14089153","51546468","180875412","3999382594","15839929","822644540","891644599617323008","418469663","752673","5135","14121511","6068142","821076998642606080","14148091","2569881","1276636970","14581738","4736263474","163808623","40141509","7698","970267602097451009","581113279","22032389","267862771","829028336","39205591","46131067","15786955","3938144855","3436615413","947909730416103425","2294707572","3295784116","2308474213","14080323","44936471","451186604","40663578","10399172","2313101960","694679411346411520","763330422247976960","87416143","3218950292","15605182","202376085","9436992","15524875","24450019","754554326","42413226","14877480","33210979","4497823337","741966131863429120","538417416","17893745","53400402","295218901","258480276","1591041914","2940773891","960198393774526469","14399709","2260999451","161794340","629330603","905255756789825536","17008438","910813992301539329","793830","15799797","930810848586731520","233318165","284051095","5923602","341874816","528933485","559284142","25967387","951199042054344704","905687730843037696","944792878991147008","277527703","819942536919785474","15755360","937595443541954560","25401953","907093277387612160","150664007","15684424","189815952","3375167474","1626294277","792008390163693568","69260635","2587563212","865524042","14993649","767755917890842624","389900156","872454019402346496","1098681096","1028595288","40631172","33719655","3654417384","274703970","389681470","756893556808220672","2483921778","30968081","668423","842336542249091073","365550734","1471618454","915124576899739648","142731803","714249015416766464","494586484","21815152","342100367","18923014","14592360","2332034436","717677786861805568","906608550423674880","108152622","271066169","23844299","2784465920","43562385","35840497","184697683","3260949332","372923595","29255412","14164578","17198118","819390317036089344","11591442","23795212","15390783","90415667","26298052","763039521936203776","160808974","872165872701407232","14447248","15799329","2437023211","19268321","102513397","17004524","82378893","323809263","12699642","145599406","3980893534","857921775589613568","10907062","736711296","153524496","98982330","281948518","1056152730","236876201","13256152","18846827","257765996","208145635","191985066","2326030830","179998630","1464749744","288719718","848351570114732033","3166283436","860186021069287424","384336868","424882243","842764530572804096","724893160590217216","14810761","67890042","2178816366","709577114","3227338044","805046388153348096","24974216","17424319","2316632196","3115053970","801582307782037504","15930040","2195013426","47900289","251021107","3117126676","259935272","792688810026991617","720697390890631168","829481318849269760","3225610602","2396580356","15002220","1690419336","733507289265496064","41686195","4054176724","14465898","62632858","763664581810061312","9164512","2741168437","70734326","4254192256","2451223458","49313109","33988099","2990293876","17501849","73690512","3326912038","12503922","3342258875","1100495504","3317837519","761468093889671168","51733979","15928797","786491","6844292","1899610795","16495353","992126114","268131653","2694038449","3855092415","58057788","732063152305627137","17660678","5454842","147460263","70713547","14742078","1965218324","67198660","716119409786535936","14093281","1616927780","10724012","754930749720055808","12767662","757196492520103936","2301808591","54030150","99480370","727704217012604928","176365870","16281891","15058072","22386325","14979631","717664565304107008","19780363","970783770","146878311","3011895469","2541004072","14103865","167193309","16158749","823484","2226895704","14788528","7585552","167140176","327925251","60174987","48006556","89017350","3023155108","37636440","23462530","61331377","35748467","14634255","3891053193","2565706501","14370184","28039629","86269324","4098072915","12910982","16979198","3160927994","833785466","15698507","15833712","166138615","4275132077","1593171","68231293","4351545915","1395955651","4768511682","1580223265","1456948207","594746113","4243400654","399985750","285465312","15045321","3121179628","473202255","114329017","320460231","823506858","3302024740","99973385","3206528621","64039045","2475321","548106686","584229130","14457722","764166","2755431692","290549888","16468446","152165589","18022416","2972744345","21782915","2834276218","53491660","170866050","5697222","17911526","1565623927","14548411","14214053","14087951","3783614721","2916305152","519629132","606973150","938152663","18576378","18557627","2194389944","103658797","42614508","1463467434","70345946","2887134689","3092003241","3240981439","3534691","21573561","3110601453","239760107","2415902426","19026624","15738610","2760385999","42646807","1297604209","2997324590","168708219","493733558","1945821067","98561440","203708235","3038481282","16318551","2312333412","2500281853","2307512569","2878457194","3018765357","45833487","14904098","384534865","106086334","1566463268","2426422297","1383021229","2975078105","378012426","260702978","14615235","2862241270","447644824","2346654529","2196680173","286989757","636933922","169191861","77969682","14521411","243865634","845453660","226835953","182821975","1307796572","2202041114","1543151882","90975373","879815347","1149277963","1611525426","1723662264","322113837","137555989","809233214","28434767","255617445","571202103","15430177","213730887","1323853950","15761650","480840152","284467345","374669566","1078494482","1399769684","193510313","284996504","1130009594","15814139","111547041","1002868244","714758552","1214155938","7385532","42189916","1068554677","227230320","50090898","16067035","18089442","80422885","31089956","20843805","56687874","192526230","1056839196","972824719","862295569","113713261","87709774","6745922","1129385892","170686450","1671811","33610839","290864535","531428881","171355355","801971814","280042052","16604718","8300112","14822853","91371819","274851574","111417822","399218063","549320964","311803815","826176116","35706683","204009252","533884891","233485486","622575246","113304873","339651608","202230373","373964148","559755744","397483391","516656666","334439311","227691007","814841","425536804","1028881","14985652","48709091","512069391","62830235","54347521","92758842","19142521","192344747","41090919","37625999","512690791","30623871","435578377","74645581","93609620","463598092","235191558","93148671","94846509","209793403","90546949","86026492","14674906","13806272","14583400","255152430","14282054","24279106","178365890","17037262","16980499","146781791","40447914","17387134"]
`;

interface JsonEntry {
  entryId: string;
  sortIndex: string;
  content?: {
    itemContent?: {
      tweet_results?: {
        result?: {
          conversation_id_str: string;
          created_at: string;
          entities?: {
            hashtags?: string[];
            symbols?: string[];
            user_mentions?: string[];
            urls?: string[];
          };
          favorite_count: number;
          quote_count: number;
          retweet_count: number;
          reply_count: number;
          retweeted: boolean;
          favorited: boolean;
          possibly_sensitive: boolean;
          lang: string;
        };
      };
    };
  };
}

interface JsonApi {
  user?: {
    result?: {
      timeline_v2?: {
        timeline?: {
          instructions?: [
            {
              entries?: JsonEntry[];
            }
          ];
        };
      };
    };
  };
}

type JsonResult =
  JsonEntry['content']['itemContent']['tweet_results']['result'];

const extractJsonResults = (jsonTweet: JsonTweet): JsonResult[] => {
  return jsonTweet.content?.itemContent?.tweet_results?.result
    ? [jsonTweet.content.itemContent.tweet_results.result]
    : [];
};

const extractFields = (tweetResult: JsonResult): Partial<JsonResult> => {
  return {
    conversation_id_str: tweetResult.conversation_id_str,
    created_at: tweetResult.created_at,
    entities: tweetResult.entities,
    favorite_count: tweetResult.favorite_count,
    quote_count: tweetResult.quote_count,
    retweet_count: tweetResult.retweet_count,
    reply_count: tweetResult.reply_count,
    retweeted: tweetResult.retweeted,
    favorited: tweetResult.favorited,
    possibly_sensitive: tweetResult.possibly_sensitive,
    lang: tweetResult.lang,
  };
};

const extractTweetData = (jsonTweet: JsonTweet): Partial<JsonResult>[] => {
  return extractJsonResults(jsonTweet)
    .map(extractFields)
    .filter((result) => result !== undefined);
};

async function fn(gameId: string) {
  let r = await fetch(
    `https://twitter.com/i/api/graphql/EG2HIdzWiBe0oIoERAUTaA/Likes?variables=%7B%22userId%22%3A%22${gameId}%22%2C%22count%22%3A20%2C%22includePromotedContent%22%3Afalse%2C%22withSuperFollowsUserFields%22%3Atrue%2C%22withDownvotePerspective%22%3Afalse%2C%22withReactionsMetadata%22%3Afalse%2C%22withReactionsPerspective%22%3Afalse%2C%22withSuperFollowsTweetFields%22%3Atrue%2C%22withClientEventToken%22%3Afalse%2C%22withBirdwatchNotes%22%3Afalse%2C%22withVoice%22%3Atrue%2C%22withV2Timeline%22%3Atrue%7D&features=%7B%22responsive_web_twitter_blue_verified_badge_is_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22view_counts_public_visibility_enabled%22%3Afalse%2C%22tweetypie_unmention_optimization_enabled%22%3Atrue%2C%22responsive_web_uc_gql_enabled%22%3Atrue%2C%22vibe_api_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Afalse%2C%22interactive_text_enabled%22%3Atrue%2C%22responsive_web_text_conversations_enabled%22%3Afalse%2C%22responsive_web_enhance_cards_enabled%22%3Atrue%7D`,
    {
      headers: {
        authorization:
          'Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA',
        'x-csrf-token':
          'ec5bb93305b5ec2d3fd8e0f563484d502d6940acf858c37923a207b2b6ba370ee41113cd5bdc9a1891f3a32473344a8046e34d3369a4bc8be11de3a775b0e770fd1c3a233890e56a81f239ecd63b891d',
        cookie: Deno.env.get('cookie')!,
      },
      body: null,
      method: 'GET',
    }
  ).then((r) => r.text());

  let p: JsonApi;
  try {
    p = JSON.parse(r);
  } catch (e: any) {
    console.log('error');
    console.log(r);
    console.log(e);
    return '';
  }

  // let filtered = p.data.user.result.timeline_v2.timeline.instructions
  //   .filter((e: any) => e.entries && e.entries.length > 0);

  // filtered = filtered.instructions[0].entries.filter((e: any) =>
  //   e.content
  //     .itemContent
  // );

  let entries =
    !p.data?.user?.result?.timeline_v2?.timeline?.instructions[0]?.entries;
  if (!entries || !entries[0]) {
    return '';
  }

  let filtered = entries.filter((e: any) => e?.content?.itemContent);

  // todo: this might filter out some types of special tweets that we would want to include
  filtered = filtered.filter(
    (e: any) => e?.content?.itemContent?.tweet_results?.result?.rest_id
  );

  let text = filtered.map(
    (e: any) => e.content.itemContent.tweet_results.result.rest_id
  );
  // let text = filtered.map((e: any) => e.content
  //     .itemContent.tweet_results.result.legacy.full_text);

  return text;
}

const sleep = (ms: any) => new Promise((r: any) => setTimeout(r, ms));

const sql = postgres(Deno.env.get('conn')!, {
  ssl: true,
});

async function insert(friendId: string, gameIds: string[]) {
  // const games0 = await sql`
  //   SELECT game_ids
  //   FROM FriendGames
  //   WHERE friend_id = 'johndoe123';
  //  `;
  const games = await sql.unsafe(`
      INSERT INTO FriendGames (friend_id, game_ids)
  VALUES ('${friendId}', '{${gameIds.toString()}}');
    `);
  // const friendGame = {

  // };
  // const games = await sql`
  //     INSERT INTO FriendGames ${
  //       sql(user, 'name', 'age')
  //     }
  //   `;
}

//const friendIds = ["40447914", "17387134"];

const friendIds = JSON.parse(json); // todo use json instead

for await (const friendId of friendIds) {
  const gameIds = await fn(friendId);
  //await insert(friendId, gameIds);
  //console.log(friendId);
  console.log(gameIds);
  await sleep(800 + Math.random() * 500);
}
